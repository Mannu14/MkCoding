<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mkcoding chat </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"></head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
     <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
     <!-- Bootstrap JS -->
     <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
 <!-- =============online offline status===== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.2/socket.io.js" ></script>
    <!-- =============omnline offline status===== -->
    <link rel="stylesheet" href="css/top.css">
    <script src="js/top.js" defer></script>
<body>
<!-- preloader start-->
<div id="preloader-preloader">
 <section class="preloader-body-container">
  <div class="preloader-container"><div class="preloader-ring"></div><div class="preloader-ring"></div><div class="preloader-ring"></div>
  <div class="preloader-netflix"><span class="preloader-left"></span><span class="preloader-center-1"></span><span class="preloader-center-2"></span><span class="preloader-right"></span></div>
  <span id="preloader-loding"></span>
  <div class="preloader-point-loader"><li class="preloader-ring-loader"></li><li class="preloader-ring-loader"></li><li class="preloader-ring-loader"></li><li class="preloader-ring-loader"></li></div>
</div>
</section>
</div>
<!--preloader End-->
<div class="">
 <header class="site-header">
 <div class="logo"><a href="/"><img src="M.jpg" alt="Logo"></a></div>
 <div class="user-info"><img src="<%= user.image %>" alt="User Avatar"><br><span><%= user.firstname %> <%= user.lastname %></span></div>
 <nav class="main-nav">
 <ul>
<ul class="list-unstyled components mb-5">
<li class="active home_icon"><a href="/"><span class="fa fa-home mr-3"></span>Home</a></li>
<li class="active"><a href="/groups"><span class="fa fa-group mr-3"></span>All Groups</a></li>
<li class="active"><a href="/group-chat"><span class="fa fa-commenting-o mr-3"></span>Group Chat</a></li>
<li><a href="/logoutchat"><span class="fa fa-sign-out mr-3"></span>Logout</a></li>
</ul>
</ul>
</nav>
</header>
</div>
<div id="content" class="p-1 p-md-0 pt-1">
</body>
</html>
<!--page content-->
<style>
body, html {margin: 0;padding: 0;}
#content{width: 100%;}
body {font-family: Arial, sans-serif;background-color: #f0f0f0;color: #333;}
.site-header {position: fixed;left: 0;top:0;background-color: #444;color: #fff;padding: 10px 0;display: flex;justify-content: space-between;align-items: center;width: 100%;}
.site-header .logo {padding: 0 20px;flex: 1;}
.site-header .logo a {text-decoration: none;color: #fff;font-size: 24px;font-weight: bold;}
.logo img{width: 60px;height: 60px;border-radius: 50%;}
.site-header .main-nav ul {list-style: none;padding: 0;margin: 0;display: contents;}
.site-header .main-nav li {margin-right: -2px;}
.site-header .main-nav a {text-decoration: none;color: #fff;font-weight: bold;transition: color 0.3s ease;}
.site-header .main-nav a:hover {color: #ccc;}
.site-header .user-info {padding: 0 20px;display: flex;align-items: center;}
.site-header .user-info span {margin-right: 10px;font-weight: bold;}
.site-header .user-info a {text-decoration: none;color: #fff;font-weight: bold;}
.site-header .user-info img {width: 40px;height: 40px;border-radius: 50%;}
header {background-color: #333;color: #fff;text-align: center;padding: 1rem;width: 100%;}
nav {background-color: #444;color: #fff;text-align: end;margin-right: 20px;padding: 0.5rem;width: 100%;}
nav ul {list-style: none;}
nav li {display: inline-block;margin: 0 1rem;}
nav a {text-decoration: none;color: #fff;}
@media screen and (max-width:720px) {
  .list-group{width: 100%;}
  .row{margin-top: 140px;}}
@media screen and (max-width:508px) {
  .logo{display: none;}}
@media screen and (max-width:408px) {
  .site-header .user-info{padding: 0 3px;}}
</style>
<link rel="stylesheet" href="css/index.css">
<div class="row">
<div id="row-list" class="col-md-0 right-links-main">
<ul class="list-group">
<% if(users.length > 0){
 for(let i = 0; i <users.length; i++){ %>
  <li class="list-group-item list-group-item-dark cursor-pointer user-list" id="<%= users[i]['_id'] %>" data-id="<%= users[i]['_id'] %>">
  <div class="mainheading_file_2"><img src="<%= users[i]['image'] %>" width="50px" height="50px" ></div>
  <%= users[i]['firstname'] +' '+ users[i]['lastname'] %>
  <% if(users[i]['is_online'] == 1){ %>
  <span class="online-status" id="<%= users[i]['_id'] %>-status"><br>Online</span>
  <%
  }else{
  %>
  <span class="offline-status" id="<%= users[i]['_id'] %>-status"><br>Offline</span>
 <%
 }
%>
</li>
<%
}
}
%>
</ul>
</div><audio id="messageSound" src="music/mkcoding_sound.mp3" type="audio/mpeg"></audio>
<h1 style="display: none;" id="data-user" data-user="<%= JSON.stringify(user) %>"></h1>
  <div id="column-list" class="col-md-8-1p">
    <h3 class="start-head" style="text-align: center;">Click to start the Chat</h3>
    <div class="chat-section">
      <div class="dispal_user">
        <i class="fa fa-arrow-left left_row_show"></i>
        <img id="user_image" src="" alt="User Image">
        <div id="chat_section_user_name"></div>
      </div>
          <div id="chat-container">
                <!-- <div class="current-user-chat">
                    <h5>Hii</h5>
                </div>
                <div class="distance-user-chat">
                    <h5>Hii</h5>
                </div> -->
        </div>
        <form action="" id="chat-form">
            <input autocomplete="off" class="border" type="text" name="message" placeholder="Enter message" id="message" required>
            <input type="submit" value="Send" class="btn btn-primary">
        </form>
    </div>
  </div>
</div>
  <!--delete Modal -->
<div class="modal fade" id="deleteChatModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
 <div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
   <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLongTitle">Delete chat</h5>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
   </div>
  <form id="delete-chat-form">    
  <div class="modal-body">
  <input type="hidden" name="id" id="delete-message-id">
  <p>Are you sure you want to delete below Message?</p>
  <p><b id="delete-message"></b></p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
<button type="submit" class="btn btn-danger">Delete</button>
</div>
</form>
</div>
</div>
</div>
  <!--update Modal -->
<div class="modal fade" id="editChatModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
 <div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLongTitle">Edit chat</h5>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <form id="update-chat-form">    
  <div class="modal-body">
    <input type="hidden" name="id" id="edit-message-id"><input type="text" name="message" id="update-message" required placeholder="Enter Message">
  </div>
  <div class="modal-footer">
  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Update</button>
  </div>
  </form>
  </div>
 </div>
</div>
<!-- delete group chat model -->
<div class="modal fade" id="deleteGroupChatModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
    <div class="modal-header"><h5 class="modal-title" id="exampleModalLongTitle">Delete chat</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">&times;</span></button>
    </div>
<form id="delete-group-chat-form">
<div class="modal-body"><input type="hidden" name="id" id="delete-group-message-id"><p>Are you sure you want to delete below Message?</p>
 <p><b id="delete-message"></b></p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-danger">Delete</button>
 </div>
</form>
 </div>
</div>
</div>
<!-- update chat group modal -->
  <div class="modal fade" id="editGroupChatModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Edit chat</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <form id="update-group-chat-form">    
        <div class="modal-body"><input type="hidden" name="id" id="edit-group-message-id"><input type="text" name="message" id="update-group-message" required placeholder="Enter Message">
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button><button type="submit" class="btn btn-primary">Update</button>
        </div>
        </form>
      </div>
    </div>
  </div>
  <div class="show-preview-box"><div class="show-details"><span class="show-icon fas fa-times"></span></div><div class="show-img-box"><img src="" alt=""></div></div>
<div class="show-shadow"></div>
  <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
  <script src="js/jquery.min.js"></script>
  <script src="/js/main.js"></script>
  <script>
      document.addEventListener('DOMContentLoaded', function () {
      const chatSectionUserName = document.getElementById('chat_section_user_name');
      const listGroupUserNames = document.querySelectorAll('.list-group .user-list');
      const rowList = document.getElementById('row-list');
      const columnList = document.getElementById('column-list');
      const handleUserClick = (userListItem) => {
        const clickedUserName = userListItem.textContent.trim().replace(/(?:Online|Offline)$/i, '');
        const clickedUserImageURL = userListItem.querySelector('.mainheading_file_2 img').src;
      const userImageElement = document.getElementById('user_image');
      userImageElement.src = clickedUserImageURL;
        chatSectionUserName.innerText = clickedUserName;
        columnList.style.transform = 'translateX(0%)';
      };
      listGroupUserNames.forEach(userListItem => {
        userListItem.addEventListener('click', () => {
          handleUserClick(userListItem);
        });
      });
      const leftRowShow = document.querySelector('.left_row_show');
      leftRowShow.addEventListener('click', function () {
        columnList.style.transform = 'translateX(200%)';
      });
      window.addEventListener('resize', function () {
        if (window.innerWidth <= 580) {
          listGroupUserNames.forEach(userListItem => {
            userListItem.removeEventListener('click', handleUserClick);
          });
          leftRowShow.removeEventListener('click', function () {
            columnList.style.transform = 'translateX(100%)';
          });
        } else {
          listGroupUserNames.forEach(userListItem => {
            userListItem.addEventListener('click', () => {
              handleUserClick(userListItem);
            });
          });
          leftRowShow.addEventListener('click', function () {
            columnList.style.transform = 'translateX(100%)';
          });
        }
      });
    });
    </script>
<style>
  body {font-family: Arial, sans-serif;overflow: hidden;overflow-y: auto;}
  h2 {color: #333;}
  ul.list-group {list-style: none;padding: 0;}
  .list-group-item {display: flex;align-items: center;margin-bottom: 10px;background-color: #fff;padding: 10px;border: 1px solid #ccc;}
  .user-list img,h2 .profile {width: 50px;height: 50px;margin-right: 10px;border-radius: 50%;}
  .user-list:hover{transform: scale(1.1);background: #a0a0a0;box-shadow: inset 0 0 5px #fff,inset 0 0 5px #fff;}
  .user-list img:hover{transform: scale(1.1);}
  .online-status {color: green;margin-left: auto;}
  .offline-status {color: red;margin-left: auto;}
  .start-head {color: #fff;margin-top: 20px;}
  .row{background: #333 !important;}
  .chat-section {background-color: #fff;padding: 20px;padding-top: 1px; border: 1px solid #ccc;}
  #chat-container {max-height: 500px;overflow-y: auto;border: 1px solid #ccc;padding: 10px;margin-bottom: 10px;}
  #chat_section_user_name{height: 30px; font-size: 20px; font-family: math;font-weight: 800;padding-left: 7px;}
  #chat-form {display: flex;justify-content: space-between;align-items: center;}
  #message {flex-grow: 1;padding: 5px;border: 1px solid #ccc;}
  .btn-primary {background-color: #007bff;color: #fff;border: none;padding: 6.75px 20px;border-radius: 0px 5px 5px 0px;cursor: pointer;}
  .btn-danger {background-color: #dc3545;color: #fff;border: none;padding: 10px 20px;cursor: pointer;}
  .border {transition: all 0.3s;outline: none;}
  .border:focus {border-color: #27ae60 !important;box-shadow: inset 0 0 3px #2fd072 !important;}
  .modal-title {color: #333;}
  .list-group{width: 100%;}
  .row{display: flex;width: 100%;overflow-y: auto;margin-top: 90px;margin-left: -8px;}
  #row-list{width: 20%;overflow-y: scroll;
        flex: 0 0 20%;
        margin-top: 3px;
        height: 87vh;}
  #column-list{width: 65%;margin-top: 3px;}
  .list-group-item{position: inherit;}
  .list-group-item:focus, .list-group-item:hover {z-index: unset;text-decoration: none;}
  /* for user */
  .selected-user-chat {background: #a0a0a0; color: blue;}
  .selected-user-chat2 {background: #fff; color: black;}
  /* for user End */
  .site-header{z-index: 5; height: 90px;}
  #row-list .list-group{margin: 20px 0;}
    .row{overflow-x: hidden;}
    .dispal_user{display: flex;align-items: center;}
  .row>*{padding-right: calc(var(--bs-gutter-x) * .1);margin-right: calc(-.1 * var(--bs-gutter-x)); margin-left: calc(-.1 * var(--bs-gutter-x));}
  .left_row_show{display: none;padding-right: 15px;}
  #user_image{width: 25px; height: 25px; border-radius: 50%;}
  @media screen and (max-width:740px) {
  #row-list{width: 25%;}
  #column-list{width: 75%;}}
  @media screen and (max-width:580px) {
    .home_icon{display: none;}
      .left_row_show{display: block;}
      .row {width: 100%;overflow: hidden;display: flex;}
      #row-list {width: 100%;overflow-y: scroll;flex: 0 0 100%;height: 87vh;}
      #column-list {width: 100%;flex: 0 0 20%;top: 95px;background-color: lightgray;position: absolute;}
      #column-list h3 {display: none;}
    }
  @media screen and (max-width:390px) {
  nav{margin-right: 0px;}
  #chat-container{padding: 0;}}
  @media screen and (max-width:360px) {
  nav{padding: 0;padding-right: 10px;}}
  </style>
  <script>
    const userDataElement = document.getElementById('data-user');
const userDatastore = userDataElement.getAttribute('data-user');
const userObject = JSON.parse(userDatastore);
localStorage.setItem('user', JSON.stringify(userObject));
  </script>